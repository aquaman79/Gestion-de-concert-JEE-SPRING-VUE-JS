<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
</head>

<body>
    <center>
        <h1>Gestion De concert</h1>
    </center>
    <main id="app">
        <button @click="showFormConnect = !showFormConnect " class="btn btn-primary">SeConnecter</button>
        <div class="sign-in-container" v-show="showFormConnect">
            <form @submit.prevent="submitConnect">
                <h1>Connexion</h1>
                <input type="text" class="form-control" placeholder="Adresse e-mail" v-model="admin.username" />
                <input type="password" class="form-control" placeholder="Mot de passe" v-model="admin.password" />
                <button type="submit" class="btn btn-primary">Se connecter</button>
            </form>
        </div>


        <template id="ma-template">
            <div class="form-group">
                <label for="date">Date:</label>
                <input type="text" class="form-control" id="date" v-model="concert.date">
            </div>
            <div class="form-group">
                <label for="duree">Durée:</label>
                <input type="number" class="form-control" id="duree" v-model.number="concert.duree">
            </div>
            <div class="form-group">
                <label for="prix">Prix:</label>
                <input type="number" class="form-control" id="prix" v-model.number="concert.prix">
            </div>
            <div class="form-group">
                <label for="salle">Salle:</label>
                <select class="form-control" id="salle" v-model.number="concert.salle.idSalle">
                    <option v-for="salle in salles" :key="salle.idSalle" :value="salle.idSalle">{{ salle.adresse }}
                    </option>
                </select>
            </div>
            <div class="form-group">
                <label for="idSoiree">Soirée:</label>
                <select class="form-control" id="salle" v-model.number="concert.soiree.idSoiree">
                    <option v-for="soiree in soirees" :key="soiree.idSoire" :value="soiree.idSoiree">{{ soiree.nomSoiree
                        }}
                    </option>
                </select>
            </div>
        </template>


        <button v-show="showAdmin" @click="showFormConcert = !showFormConcert " class="btn btn-primary">Creer
            concert</button>
        <div class="mt-3" v-show="showFormConcert">
            <form @submit.prevent="submitForm">
                <!-- <div v-if="showTemplate">
                    <ma-template></ma-template>
                </div> -->
                <div class="form-group">
                    <label for="date">Date:</label>
                    <input type="text" class="form-control" id="date" v-model="concert.date">
                </div>
                <div class="form-group">
                    <label for="duree">Durée:</label>
                    <input type="number" class="form-control" id="duree" v-model.number="concert.duree">
                </div>
                <div class="form-group">
                    <label for="prix">Prix:</label>
                    <input type="number" class="form-control" id="prix" v-model.number="concert.prix">
                </div>
                <div class="form-group">
                    <label for="salle">Salle:</label>
                    <select class="form-control" id="salle" v-model.number="concert.salle.idSalle">
                        <option v-for="salle in salles" :key="salle.idSalle" :value="salle.idSalle">{{ salle.adresse }}
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="idSoiree">Soirée:</label>
                    <select class="form-control" id="salle" v-model.number="concert.soiree.idSoiree">
                        <option v-for="soiree in soirees" :key="soiree.idSoire" :value="soiree.idSoiree">{{
                            soiree.nomSoiree }}
                        </option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="id-groupe">Groupe:</label>
                    <select class="form-control" id="groupe" v-model.number="concert.groupe.id_groupe">
                        <option v-for="groupe in groupes" :key="groupe.id_groupe" :value="groupe.id_groupe">{{
                            groupe.nom_groupe }}
                        </option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
        <!-- <p>ici boutton groupe</p> -->
        <a href="groupe-vue1.html"><button v-show="showAdmin" class="btn btn-primary">Groupe</button></a>
        <!-- <button v-show="showAdmin" @click="window.location.href='groupe-vue.html'" class="btn btn-primary">Groupe</button> -->
        <!-- <div>Soiree</div> -->
        <button v-show="showAdmin" @click="showFormSoiree = !showFormSoiree " class="btn btn-primary">Creer
            Soiree</button>
        <div class="mt-3" v-show="showFormSoiree">
            <form @submit.prevent="submitFormSoiree">
                <!-- <div v-if="showTemplate">
                    <ma-template></ma-template>
                </div> -->
                <div class="form-group">
                    <label for="Nom de Soiree ">Soiree:</label>
                    <input type="text" class="form-control" id="nom" v-model="soiree.nomSoiree">
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>

        <button v-show="showAdmin" @click="showFormSalle = !showFormSalle " class="btn btn-primary">Creer Salle</button>
        <!-- <div>Salle</div> -->
        <div class="mt-3" v-show="showFormSalle">
            <form @submit.prevent="submitFormSalle">
                <div class="form-group">
                    <label for=" adresse Salle ">Adresse de salle:</label>
                    <input type="text" class="form-control" id="nom" v-model="salle.adresse">
                </div>
                <div class="form-group">
                    <label for=" capacitee salle ">capacite de salle:</label>
                    <input type="text" class="form-control" id="nom" v-model.number="salle.capacite">
                </div>
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>


        <section id="concerts" class="mt-3">
            <h2>Liste des concerts</h2>
            <p>Il y a {{ nbConcerts }} concerts dans la base.</p>
            <div v-for="concert in concerts" :key="concert.id" class="border p-3 my-3">
                <div>
                    <h3>{{ concert.soiree.nomSoiree }}</h3>
                    <p>sera à {{ concert.salle.adresse }}</p>
                    <p>Heure : {{concert.date}}</p>
                    <p>le groupe present est {{concert.groupe.nom_groupe}}</p>
                    <p>la capacité de salle {{concert.salle.capacite}}</p>
                    <button type="submit" class="btn btn-secondary"      @click="decrementer()">-</button>
                    <input type="number" class="form-control" value="1" id="nbplace">
                    <button type="submit" class="btn btn-secondary" @click="increment()" >+</button>

                    <button type="button" class="btn btn-primary" data-toggle="modal"
                        data-target="#myModal">Reserver</button>

                    <!-- La popup -->
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <form action="traitement.php" method="POST">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h4 class="modal-title" id="myModalLabel">Réservation</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="form-group">
                                            <label for="nom">Nom :</label>
                                            <input type="text" id="nom" name="nom" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="email">Email :</label>
                                            <input type="email" id="email"
                                                pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" size="30" required>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary"
                                            data-dismiss="modal">Fermer</button>
                                        <button type="button" class="btn btn-primary" type="submit">Sauvegarder</button>
                                    </div>
                            </form>
                        </div>


                    </div>






                </div>
                <div>
                    <button class="btn btn-primary" type="submit" v-show="showAdmin"
                        @click="showTemplate = !showTemplate">Mettre à
                        jour</button>
                    <button class="btn btn-danger" type="submit" style="background-color: red " v-show="showAdmin"
                        @click="supprime(concert)">Supprimer</button>
                    <div v-show="showTemplate">
                        <div class="mt-3">
                            <form @submit.prevent="updateConcert(concert)">
                                <!-- <div v-if="showTemplate">
                                <ma-template></ma-template>
                            </div> -->
                                <div class="form-group">
                                    <label for="date">Date:</label>
                                    <input type="text" class="form-control" id="date" v-model="concert.date">
                                </div>
                                <div class="form-group">
                                    <label for="duree">Durée:</label>
                                    <input type="number" class="form-control" id="duree" v-model.number="concert.duree">
                                </div>
                                <div class="form-group">
                                    <label for="prix">Prix:</label>
                                    <input type="number" class="form-control" id="prix" v-model.number="concert.prix">
                                </div>
                                <div class="form-group">
                                    <label for="salle">Salle:</label>
                                    <select class="form-control" id="salle" v-model.number="concert.salle.idSalle">
                                        <option v-for="salle in salles" :key="salle.idSalle" :value="salle.idSalle">{{
                                            salle.adresse }}
                                        </option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="idSoiree">Soirée:</label>
                                    <select class="form-control" id="salle" v-model.number="concert.soiree.idSoiree">
                                        <option v-for="soiree in soirees" :key="soiree.idSoire"
                                            :value="soiree.idSoiree">{{ soiree.nomSoiree
                                            }}</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="id_groupe">Groupe:</label>
                                    <select class="form-control" id="groupe" v-model.number="concert.groupe.id_groupe">
                                        <option v-for="groupe in groupes" :key="groupe.id_groupe"
                                            :value="groupe.id_groupe">
                                            {{groupe.nom_groupe }}
                                        </option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">Submit</button>
                            </form>
                        </div>

                    </div>
                </div>
        </section>
    </main>

    <script src="https://unpkg.com/vue@next"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-E0R1FkEQ+27f6UyHrtUOx6gcyo6QfjzBbxGrE1X4YY4NG/Vl5A/1KjyA2ayn2q3q"
        crossorigin="anonymous"></script>

    <script>



        const Concerts = {

            data() {
                return {
                    showTemplate: false,
                    auteur: "Ayoub QUAMAR",
                    concerts: [],
                    salles: [],
                    soirees: [],
                    groupes: [],
                    concert: {
                        "date": "",
                        "duree": null,
                        "prix": null,
                        "salle": {
                            "idSalle": null,
                        },
                        "soiree": {
                            "idSoiree": null,
                        },
                        "groupe": {
                            "id_groupe": null,
                        }
                    },
                    soiree: {
                        "nomSoiree": ""
                    },
                    salle: {
                        "adresse": "",
                        "capacite": null
                    },
                    groupe: {
                        "nom_groupe": "",
                        "description": ""
                    },
                    showFormConnect: false,
                    showFormSalle: false,
                    showFormConcert: false,
                    showFormSoiree: false,
                    admin: {
                        "username": "",
                        "password": ""
                    },
                    showAdmin: false
                }
            },

            created() {
                fetch('http://localhost:8080/Groupe')
                    .then((response) => response.json())
                    .then((json) => {
                        this.groupes = json
                        console.log(this.groupe);
                    });

                fetch('http://localhost:8080/Soiree')
                    .then((response) => response.json())
                    .then((json) => { this.soirees = json });


                fetch('http://localhost:8080/Salle')
                    .then((response) => response.json())
                    .then((json) => { this.salles = json });


                fetch('http://localhost:8080/Concert')
                    .then((response) => response.json())
                    .then((json) => { this.concerts = json });


            },
            methods: {
                async submitConnect() {
                    const response = await fetch('http://localhost:8090/DAO/Login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.admin),
                    })
                    const json = await response.json();
                    this.showAdmin = json.token;
                    console.log(this.showAdmin);
                },
                submitForm() {
                    fetch('http://localhost:8080/Concert', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.concert),
                    }
                    )
                    console.log(JSON.stringify(this.concert));
                },
                submitFormSoiree() {
                    fetch('http://localhost:8080/Soiree', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.soiree),
                    }
                    )
                },
                submitFormSalle() {
                    fetch('http://localhost:8080/Salle', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.salle),
                    }
                    )
                },
                async updateConcert(concert) {
                    console.log(concert)
                    this.concert.date = concert.date
                    this.concert.duree = concert.duree
                    this.concert.prix = concert.prix
                    this.concert.salle.idSalle = concert.salle.idSalle
                    this.concert.soiree.idSoiree = concert.soiree.idSoiree

                    await fetch(`http://localhost:8080/Concert/${concert.id}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.concert),
                    })
                    console.log(JSON.stringify(this.concert));
                },
                supprime(concert) {
                    fetch(`http://localhost:8080/Concert/${concert.id}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(concert.id),
                    })
                },
                 decrementer() {
                    console.log("je suis ici");
                    var input = document.getElementById("nbplace");
                    var currentValue = parseInt(input.value);
                    if (currentValue > this.concert.salle.capacite) {
                        input.value = currentValue - 1;
                    }
                },
                     increment() {
                    var input = document.getElementById("nbplace");
                    var currentValue = parseInt(input.value);
                    if (currentValue < this.concert.salle.capacite) {
                        input.value = currentValue + 1;
                    }
                }
                
            },
            computed: {
                nbConcerts() {
                    return this.concerts.length
                }
            }
        }
        const app = Vue.createApp(Concerts).mount('#app')
     
    </script>
</body>

</html>